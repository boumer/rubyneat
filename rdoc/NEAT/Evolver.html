<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class NEAT::Evolver - rubyneat 0.3.4</title>

<link href="../fonts.css" rel="stylesheet">
<link href="../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/navigation.js"></script>
<script src="../js/search_index.js"></script>
<script src="../js/search.js"></script>
<script src="../js/searcher.js"></script>
<script src="../js/darkfish.js"></script>


<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">Operator
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li class="calls-super" ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-i-evolve">#evolve</a>
    
    <li ><a href="#method-i-gen_initial_genes-21">#gen_initial_genes!</a>
    
    <li ><a href="#method-i-mate-21">#mate!</a>
    
    <li ><a href="#method-i-mutate-21">#mutate!</a>
    
    <li ><a href="#method-i-mutate_add_genes-21">#mutate_add_genes!</a>
    
    <li ><a href="#method-i-mutate_add_neurons-21">#mutate_add_neurons!</a>
    
    <li ><a href="#method-i-mutate_change_gene_weights-21">#mutate_change_gene_weights!</a>
    
    <li ><a href="#method-i-mutate_change_neurons-21">#mutate_change_neurons!</a>
    
    <li ><a href="#method-i-mutate_disable_genes-21">#mutate_disable_genes!</a>
    
    <li ><a href="#method-i-mutate_perturb_gene_weights-21">#mutate_perturb_gene_weights!</a>
    
    <li ><a href="#method-i-mutate_reenable_genes-21">#mutate_reenable_genes!</a>
    
    <li ><a href="#method-i-prepare_fitness-21">#prepare_fitness!</a>
    
    <li ><a href="#method-i-prepare_novelty-21">#prepare_novelty!</a>
    
    <li ><a href="#method-i-prepare_speciation-21">#prepare_speciation!</a>
    
    <li ><a href="#method-i-sex">#sex</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-NEAT::Evolver">
  <h1 id="class-NEAT::Evolver" class="class">
    class NEAT::Evolver
  </h1>

  <section class="description">
    
<h1 id="class-NEAT::Evolver-label-Evolver+--+Basis+of+all+evolvers."><a href="Evolver.html">Evolver</a> â€“ Basis of all evolvers.<span><a href="#class-NEAT::Evolver-label-Evolver+--+Basis+of+all+evolvers.">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<pre>All evolvers shall derive from this basic evolver (or this one can be
used as is). Here, we&#39;ll have many different evolutionary operators
that will perform operations on the various critters in the population.</pre>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    
    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      
      <div id="attribute-i-npop" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">npop</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
    </section>
    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(c)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/rubyneat/evolver.rb, line 13</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">c</span>)
  <span class="ruby-keyword">super</span>
  <span class="ruby-ivar">@critter_op</span> = <span class="ruby-constant">CritterOp</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-evolve" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">evolve</span><span
            class="method-args">(population)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Here we clone the population and then evolve it on the basis of fitness and
novelty, etc.</p>

<p>Returns  the newly-evolved population.</p>
          
          

          
          <div class="method-source-code" id="evolve-source">
            <pre><span class="ruby-comment"># File lib/rubyneat/evolver.rb, line 53</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">evolve</span>(<span class="ruby-identifier">population</span>)
  <span class="ruby-ivar">@npop</span> = <span class="ruby-identifier">population</span>.<span class="ruby-identifier">dclone</span>
  
  <span class="ruby-comment"># Population sorting and evaluation for breeding, mutations, etc.</span>
  <span class="ruby-identifier">prepare_speciation!</span>
  <span class="ruby-identifier">prepare_fitness!</span>
  <span class="ruby-identifier">prepare_novelty!</span>

  <span class="ruby-identifier">mate!</span>

  <span class="ruby-keyword">return</span> <span class="ruby-ivar">@npop</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-gen_initial_genes-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">gen_initial_genes!</span><span
            class="method-args">(genotype)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Generate the initial genes for a given genotype. We key genes off their
innovation numbers.</p>
          
          

          
          <div class="method-source-code" id="gen_initial_genes-21-source">
            <pre><span class="ruby-comment"># File lib/rubyneat/evolver.rb, line 20</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">gen_initial_genes!</span>(<span class="ruby-identifier">genotype</span>)
  <span class="ruby-identifier">genotype</span>.<span class="ruby-identifier">genes</span> = {}
  <span class="ruby-identifier">genotype</span>.<span class="ruby-identifier">neural_inputs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s1</span>, <span class="ruby-identifier">input</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">genotype</span>.<span class="ruby-identifier">neural_outputs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s2</span>, <span class="ruby-identifier">output</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">g</span> = <span class="ruby-constant">Critter</span><span class="ruby-operator">::</span><span class="ruby-constant">Genotype</span><span class="ruby-operator">::</span><span class="ruby-constant">Gene</span>[<span class="ruby-identifier">genotype</span>, <span class="ruby-identifier">input</span>, <span class="ruby-identifier">output</span>, <span class="ruby-constant">NEAT</span><span class="ruby-operator">::</span><span class="ruby-identifier">controller</span>.<span class="ruby-identifier">gaussian</span>]
      <span class="ruby-identifier">genotype</span>.<span class="ruby-identifier">genes</span>[<span class="ruby-identifier">g</span>.<span class="ruby-identifier">innovation</span>] = <span class="ruby-identifier">g</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-mutate-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">mutate!</span><span
            class="method-args">(population)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Here we mutate the population.</p>
          
          

          
          <div class="method-source-code" id="mutate-21-source">
            <pre><span class="ruby-comment"># File lib/rubyneat/evolver.rb, line 31</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">mutate!</span>(<span class="ruby-identifier">population</span>)
  <span class="ruby-ivar">@npop</span> = <span class="ruby-identifier">population</span>

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@controller</span>.<span class="ruby-identifier">parms</span>.<span class="ruby-identifier">mate_only_prob</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">rand</span> <span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@controller</span>.<span class="ruby-identifier">parms</span>.<span class="ruby-identifier">mate_only_prob</span>
    <span class="ruby-identifier">log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-string">&quot;[[[ Neuron and Gene Giggling!&quot;</span>
    <span class="ruby-identifier">mutate_perturb_gene_weights!</span>
    <span class="ruby-identifier">mutate_change_gene_weights!</span>
    <span class="ruby-identifier">mutate_add_neurons!</span>
    <span class="ruby-identifier">mutate_change_neurons!</span>
    <span class="ruby-identifier">mutate_add_genes!</span>
    <span class="ruby-identifier">mutate_disable_genes!</span>
    <span class="ruby-identifier">mutate_reenable_genes!</span>
    <span class="ruby-identifier">log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-string">&quot;]]] End Neuron and Gene Giggling!\n&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-string">&quot;*** Mating only!&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="protected-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Protected Instance Methods</h3>
       </header>

    
      <div id="method-i-mate-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">mate!</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Here we select candidates for mating. We must look at species and fitness
to make the selection for mating.</p>
          
          

          
          <div class="method-source-code" id="mate-21-source">
            <pre><span class="ruby-comment"># File lib/rubyneat/evolver.rb, line 167</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">mate!</span>
  <span class="ruby-identifier">parm</span> = <span class="ruby-ivar">@controller</span>.<span class="ruby-identifier">parms</span>
  <span class="ruby-identifier">popsize</span> = <span class="ruby-identifier">parm</span>.<span class="ruby-identifier">population_size</span>
  <span class="ruby-identifier">surv</span> = <span class="ruby-identifier">parm</span>.<span class="ruby-identifier">survival_threshold</span>
  <span class="ruby-identifier">survmin</span> = <span class="ruby-identifier">parm</span>.<span class="ruby-identifier">survival_mininum_per_species</span>
  <span class="ruby-identifier">mlist</span> = [] <span class="ruby-comment"># list of chosen mating pairs of critters [crit1, crit2], or [:carryover, crit]</span>

  <span class="ruby-comment"># species list already sorted in descending order of fitness.</span>
  <span class="ruby-comment"># We will generate the approximate number of  pairs that correspond</span>
  <span class="ruby-comment"># to the survivial_threshold percentage of the population,</span>
  <span class="ruby-comment"># then backfill with the most fit out of the top original population.</span>
  <span class="ruby-ivar">@npop</span>.<span class="ruby-identifier">species</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">sp</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">crem</span> = [(<span class="ruby-identifier">sp</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">surv</span>).<span class="ruby-identifier">ceil</span>, <span class="ruby-identifier">survmin</span>].<span class="ruby-identifier">max</span>
    <span class="ruby-identifier">log</span>.<span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;Minumum per species hit -- #{survmin}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">crem</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">survmin</span>
    <span class="ruby-identifier">spsel</span> = <span class="ruby-identifier">sp</span>[<span class="ruby-value">0</span>, <span class="ruby-identifier">crem</span>]
    <span class="ruby-identifier">spsel</span> = <span class="ruby-identifier">sp</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">spsel</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">crem</span>.<span class="ruby-identifier">times</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">mlist</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">spsel</span>[<span class="ruby-identifier">rand</span> <span class="ruby-identifier">spsel</span>.<span class="ruby-identifier">size</span>], <span class="ruby-identifier">spsel</span>[<span class="ruby-identifier">rand</span> <span class="ruby-identifier">spsel</span>.<span class="ruby-identifier">size</span>]]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># And now for the backfilling</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">mlist</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@npop</span>.<span class="ruby-identifier">critters</span>.<span class="ruby-identifier">size</span>
    <span class="ruby-identifier">mlist</span> <span class="ruby-operator">+=</span> <span class="ruby-ivar">@npop</span>.<span class="ruby-identifier">critters</span>[<span class="ruby-value">0</span>, <span class="ruby-ivar">@npop</span>.<span class="ruby-identifier">critters</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">mlist</span>.<span class="ruby-identifier">size</span>].<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">crit</span><span class="ruby-operator">|</span> [<span class="ruby-value">:carryover</span>, <span class="ruby-identifier">crit</span>]}
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@npop</span>.<span class="ruby-identifier">critters</span> = <span class="ruby-identifier">mlist</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">crit1</span>, <span class="ruby-identifier">crit2</span><span class="ruby-operator">|</span>
    (<span class="ruby-identifier">crit1</span> <span class="ruby-operator">==</span> <span class="ruby-value">:carryover</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">crit2</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">sex</span>(<span class="ruby-identifier">crit1</span>, <span class="ruby-identifier">crit2</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-mutate_add_genes-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">mutate_add_genes!</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="mutate_add_genes-21-source">
            <pre><span class="ruby-comment"># File lib/rubyneat/evolver.rb, line 124</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">mutate_add_genes!</span>
  <span class="ruby-ivar">@npop</span>.<span class="ruby-identifier">critters</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">critter</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">rand</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@controller</span>.<span class="ruby-identifier">parms</span>.<span class="ruby-identifier">mutate_add_gene_prob</span>
      <span class="ruby-identifier">log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;mutate_add_genes! for #{critter}&quot;</span>
      <span class="ruby-ivar">@critter_op</span>.<span class="ruby-identifier">add_gene!</span> <span class="ruby-identifier">critter</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-mutate_add_neurons-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">mutate_add_neurons!</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="mutate_add_neurons-21-source">
            <pre><span class="ruby-comment"># File lib/rubyneat/evolver.rb, line 151</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">mutate_add_neurons!</span>
  <span class="ruby-ivar">@npop</span>.<span class="ruby-identifier">critters</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">critter</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">rand</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@controller</span>.<span class="ruby-identifier">parms</span>.<span class="ruby-identifier">mutate_add_neuron_prob</span>
      <span class="ruby-identifier">log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;mutate_add_neurons! for #{critter}&quot;</span>
      <span class="ruby-ivar">@critter_op</span>.<span class="ruby-identifier">add_neuron!</span> <span class="ruby-identifier">critter</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-mutate_change_gene_weights-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">mutate_change_gene_weights!</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Totally change weights to something completely different</p>
          
          

          
          <div class="method-source-code" id="mutate_change_gene_weights-21-source">
            <pre><span class="ruby-comment"># File lib/rubyneat/evolver.rb, line 112</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">mutate_change_gene_weights!</span>
  <span class="ruby-ivar">@gchange</span> = <span class="ruby-constant">Distribution</span><span class="ruby-operator">::</span><span class="ruby-constant">Normal</span><span class="ruby-operator">::</span><span class="ruby-identifier">rng</span>(<span class="ruby-value">0</span>, <span class="ruby-ivar">@controller</span>.<span class="ruby-identifier">parms</span>.<span class="ruby-identifier">mutate_change_gene_weights_sd</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gchange</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@npop</span>.<span class="ruby-identifier">critters</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">critter</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">critter</span>.<span class="ruby-identifier">genotype</span>.<span class="ruby-identifier">genes</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">innov</span>, <span class="ruby-identifier">gene</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">rand</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@controller</span>.<span class="ruby-identifier">parms</span>.<span class="ruby-identifier">mutate_change_gene_weights_prob</span>
        <span class="ruby-identifier">gene</span>.<span class="ruby-identifier">weight</span> = <span class="ruby-identifier">chg</span> = <span class="ruby-ivar">@gchange</span>.()
        <span class="ruby-identifier">log</span>.<span class="ruby-identifier">debug</span> { <span class="ruby-node">&quot;Change gene #{gene}.#{innov} by #{chg}&quot;</span> }
      <span class="ruby-keyword">end</span>
    }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-mutate_change_neurons-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">mutate_change_neurons!</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>TODO Finish mutate_change_neurons!</p>
          
          

          
          <div class="method-source-code" id="mutate_change_neurons-21-source">
            <pre><span class="ruby-comment"># File lib/rubyneat/evolver.rb, line 161</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">mutate_change_neurons!</span>
  <span class="ruby-identifier">log</span>.<span class="ruby-identifier">error</span> <span class="ruby-string">&quot;mutate_change_neurons! NIY&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-mutate_disable_genes-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">mutate_disable_genes!</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="mutate_disable_genes-21-source">
            <pre><span class="ruby-comment"># File lib/rubyneat/evolver.rb, line 133</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">mutate_disable_genes!</span>
  <span class="ruby-ivar">@npop</span>.<span class="ruby-identifier">critters</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">critter</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">rand</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@controller</span>.<span class="ruby-identifier">parms</span>.<span class="ruby-identifier">mutate_gene_disable_prob</span>
      <span class="ruby-identifier">log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;mutate_disable_genes! for #{critter}&quot;</span>
      <span class="ruby-ivar">@critter_op</span>.<span class="ruby-identifier">disable_gene!</span> <span class="ruby-identifier">critter</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-mutate_perturb_gene_weights-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">mutate_perturb_gene_weights!</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Perturb existing gene weights by adding a guassian to them.</p>
          
          

          
          <div class="method-source-code" id="mutate_perturb_gene_weights-21-source">
            <pre><span class="ruby-comment"># File lib/rubyneat/evolver.rb, line 99</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">mutate_perturb_gene_weights!</span>
  <span class="ruby-ivar">@gperturb</span> = <span class="ruby-constant">Distribution</span><span class="ruby-operator">::</span><span class="ruby-constant">Normal</span><span class="ruby-operator">::</span><span class="ruby-identifier">rng</span>(<span class="ruby-value">0</span>, <span class="ruby-ivar">@controller</span>.<span class="ruby-identifier">parms</span>.<span class="ruby-identifier">mutate_perturb_gene_weights_sd</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@gperturb</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@npop</span>.<span class="ruby-identifier">critters</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">critter</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">critter</span>.<span class="ruby-identifier">genotype</span>.<span class="ruby-identifier">genes</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">innov</span>, <span class="ruby-identifier">gene</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">rand</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@controller</span>.<span class="ruby-identifier">parms</span>.<span class="ruby-identifier">mutate_perturb_gene_weights_prob</span>
        <span class="ruby-identifier">gene</span>.<span class="ruby-identifier">weight</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">per</span> = <span class="ruby-ivar">@gperturb</span>.()
        <span class="ruby-identifier">log</span>.<span class="ruby-identifier">debug</span> { <span class="ruby-node">&quot;Peturbed gene #{gene}.#{innov} by #{per}&quot;</span> }
      <span class="ruby-keyword">end</span>
    }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-mutate_reenable_genes-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">mutate_reenable_genes!</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="mutate_reenable_genes-21-source">
            <pre><span class="ruby-comment"># File lib/rubyneat/evolver.rb, line 142</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">mutate_reenable_genes!</span>
  <span class="ruby-ivar">@npop</span>.<span class="ruby-identifier">critters</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">critter</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">rand</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@controller</span>.<span class="ruby-identifier">parms</span>.<span class="ruby-identifier">mutate_gene_reenable_prob</span>
      <span class="ruby-identifier">log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;mutate_reenable_genes! for #{critter}&quot;</span>
      <span class="ruby-ivar">@critter_op</span>.<span class="ruby-identifier">reenable_gene!</span> <span class="ruby-identifier">critter</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-prepare_fitness-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">prepare_fitness!</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sort species within the basis of fitness. Think of the fitness as an error
/ cost function. The better fit, the closer to zero the fitness parameter
will be.</p>

<p>If a compare block is specified in the <a href="DSL.html">DSL</a>, then
that function is called with the *fitness values* from critters c1 and c2.
The default valuation is c1.fitness &lt;=&gt; c2.fitness. You may elect to
evaluate them differently.</p>
          
          

          
          <div class="method-source-code" id="prepare_fitness-21-source">
            <pre><span class="ruby-comment"># File lib/rubyneat/evolver.rb, line 82</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">prepare_fitness!</span>
  <span class="ruby-ivar">@npop</span>.<span class="ruby-identifier">species</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">sp</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">sp</span>.<span class="ruby-identifier">sort!</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">c1</span>, <span class="ruby-identifier">c2</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@controller</span>.<span class="ruby-identifier">compare_func</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-ivar">@controller</span>.<span class="ruby-identifier">compare_func</span>.(<span class="ruby-identifier">c1</span>.<span class="ruby-identifier">fitness</span>, <span class="ruby-identifier">c2</span>.<span class="ruby-identifier">fitness</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">c1</span>.<span class="ruby-identifier">fitness</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">c2</span>.<span class="ruby-identifier">fitness</span>
      <span class="ruby-keyword">end</span>
    }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-prepare_novelty-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">prepare_novelty!</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>TODO: write novelty code</p>
          
          

          
          <div class="method-source-code" id="prepare_novelty-21-source">
            <pre><span class="ruby-comment"># File lib/rubyneat/evolver.rb, line 95</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">prepare_novelty!</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-prepare_speciation-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">prepare_speciation!</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Here we specify evolutionary operators.</p>
          
          

          
          <div class="method-source-code" id="prepare_speciation-21-source">
            <pre><span class="ruby-comment"># File lib/rubyneat/evolver.rb, line 69</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">prepare_speciation!</span>
  <span class="ruby-ivar">@npop</span>.<span class="ruby-identifier">speciate!</span>
  <span class="ruby-identifier">log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-string">&quot;SPECIES:&quot;</span>
  <span class="ruby-constant">NEAT</span><span class="ruby-operator">::</span><span class="ruby-identifier">dpp</span> <span class="ruby-ivar">@npop</span>.<span class="ruby-identifier">species</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-sex" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">sex</span><span
            class="method-args">(crit1, crit2)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Mate the given critters and return a baby. This is rather involved, and
relies heavily on the Innovation Numbers.</p>

<p>Some definitions:</p>

<pre>Matching Gene
 2 genes with matching innovation numbers.

Disjoint Gene
 A gene in one has an innovation number in the range of innovation numbers
 of the other.

Excess Gene
 Gene in one critter that has an innovation number outside of the range
 of innovation numbers of the other.

Neurons
 Distinct Neurons from both crit1 and crit2 must be present in
 the baby.</pre>

<p>Excess and Disjoint genes are always included from the more fit parent.
Matching genes are randomly chosen. For now, we make it 50/50.</p>
          
          

          
          <div class="method-source-code" id="sex-source">
            <pre><span class="ruby-comment"># File lib/rubyneat/evolver.rb, line 221</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">sex</span>(<span class="ruby-identifier">crit1</span>, <span class="ruby-identifier">crit2</span>)
  <span class="ruby-constant">Critter</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@npop</span>, <span class="ruby-keyword">true</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">baby</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">fitcrit</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">crit1</span>.<span class="ruby-identifier">fitness</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">crit2</span>.<span class="ruby-identifier">fitness</span>
                <span class="ruby-identifier">crit1</span>
              <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">crit2</span>.<span class="ruby-identifier">fitness</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">crit1</span>.<span class="ruby-identifier">fitness</span>
                <span class="ruby-identifier">crit2</span>
              <span class="ruby-keyword">else</span>
                (<span class="ruby-identifier">rand</span>(<span class="ruby-value">2</span>) <span class="ruby-operator">==</span> <span class="ruby-value">1</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">crit1</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">crit2</span>
              <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">a</span> = <span class="ruby-identifier">crit1</span>.<span class="ruby-identifier">genotype</span>.<span class="ruby-identifier">genes</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">to_set</span>
    <span class="ruby-identifier">b</span> = <span class="ruby-identifier">crit2</span>.<span class="ruby-identifier">genotype</span>.<span class="ruby-identifier">genes</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">to_set</span>
    <span class="ruby-identifier">disjoint</span> = (<span class="ruby-identifier">a</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">b</span>) <span class="ruby-operator">+</span> (<span class="ruby-identifier">b</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">a</span>)
    <span class="ruby-identifier">joint</span> = (<span class="ruby-identifier">a</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">b</span>) <span class="ruby-operator">-</span> <span class="ruby-identifier">disjoint</span>
    <span class="ruby-identifier">baby</span>.<span class="ruby-identifier">genotype</span>.<span class="ruby-identifier">neucleate</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">gtype</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">joint</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">innov</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">g1</span> = <span class="ruby-identifier">crit1</span>.<span class="ruby-identifier">genotype</span>.<span class="ruby-identifier">genes</span>[<span class="ruby-identifier">innov</span>]
        <span class="ruby-identifier">g2</span> = <span class="ruby-identifier">crit2</span>.<span class="ruby-identifier">genotype</span>.<span class="ruby-identifier">genes</span>[<span class="ruby-identifier">innov</span>]
        <span class="ruby-constant">Critter</span><span class="ruby-operator">::</span><span class="ruby-constant">Genotype</span><span class="ruby-operator">::</span><span class="ruby-constant">Gene</span>[<span class="ruby-identifier">gtype</span>,
                                <span class="ruby-identifier">g1</span>.<span class="ruby-identifier">in_neuron</span>, <span class="ruby-identifier">g1</span>.<span class="ruby-identifier">out_neuron</span>,
                                (<span class="ruby-identifier">rand</span>(<span class="ruby-value">2</span>) <span class="ruby-operator">==</span> <span class="ruby-value">1</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">g1</span>.<span class="ruby-identifier">weight</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">g2</span>.<span class="ruby-identifier">weight</span>,
                                <span class="ruby-identifier">innov</span>]
      } <span class="ruby-operator">+</span> <span class="ruby-identifier">disjoint</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">innov</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">fitcrit</span>.<span class="ruby-identifier">genotype</span>.<span class="ruby-identifier">genes</span>[<span class="ruby-identifier">innov</span>].<span class="ruby-identifier">clone</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">fitcrit</span>.<span class="ruby-identifier">genotype</span>.<span class="ruby-identifier">genes</span>[<span class="ruby-identifier">innov</span>].<span class="ruby-identifier">nil?</span>
      }.<span class="ruby-identifier">reject</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">i</span>.<span class="ruby-identifier">nil?</span> }
    }
    <span class="ruby-identifier">baby</span>.<span class="ruby-identifier">genotype</span>.<span class="ruby-identifier">innervate!</span> <span class="ruby-identifier">crit1</span>.<span class="ruby-identifier">genotype</span>.<span class="ruby-identifier">neurons</span>, <span class="ruby-identifier">crit2</span>.<span class="ruby-identifier">genotype</span>.<span class="ruby-identifier">neurons</span>
    <span class="ruby-identifier">baby</span>.<span class="ruby-identifier">genotype</span>.<span class="ruby-identifier">prune!</span>
    <span class="ruby-identifier">baby</span>.<span class="ruby-identifier">genotype</span>.<span class="ruby-identifier">wire!</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://rdoc.rubyforge.org">RDoc</a> 4.1.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

