<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class NEAT::Expressor - rubyneat 0.3.4</title>

<link href="../fonts.css" rel="stylesheet">
<link href="../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/navigation.js"></script>
<script src="../js/search_index.js"></script>
<script src="../js/search.js"></script>
<script src="../js/searcher.js"></script>
<script src="../js/darkfish.js"></script>


<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">Operator
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li class="calls-super" ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-i-express-21">#express!</a>
    
    <li ><a href="#method-i-express_expression-21">#express_expression!</a>
    
    <li ><a href="#method-i-express_genes-21">#express_genes!</a>
    
    <li ><a href="#method-i-express_neurons-21">#express_neurons!</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-NEAT::Expressor">
  <h1 id="class-NEAT::Expressor" class="class">
    class NEAT::Expressor
  </h1>

  <section class="description">
    
<h1 id="class-NEAT::Expressor-label-Basis+of+all+expressors.+">Basis of all expressors. <span><a href="#class-NEAT::Expressor-label-Basis+of+all+expressors.+">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<pre>Expressor object turn genotypes into phenotypes.</pre>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(c)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/rubyneat/expressor.rb, line 8</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">c</span>)
  <span class="ruby-keyword">super</span>      
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-express-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">express!</span><span
            class="method-args">(critter)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Take the genotype of the critter and create a phenotype from the genotype.</p>

<p>In the phenotype, it creates a function called stimulate(), which is called
with the input parameters and returns a response in the form of a response
hash (which corresponds directly to the output neurons).</p>

<p>This implementation assumes an acyclic graph (feed forward) and cannot
handle cycles at all. Later we may fix this or create a type of <a
href="Expressor.html">Expressor</a> that can.</p>
          
          

          
          <div class="method-source-code" id="express-21-source">
            <pre><span class="ruby-comment"># File lib/rubyneat/expressor.rb, line 23</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">express!</span>(<span class="ruby-identifier">critter</span>)
  <span class="ruby-identifier">critter</span>.<span class="ruby-identifier">ready_for_expression!</span>
  <span class="ruby-identifier">express_neurons!</span> <span class="ruby-identifier">critter</span>
  <span class="ruby-identifier">express_genes!</span> <span class="ruby-identifier">critter</span>
  <span class="ruby-identifier">express_expression!</span> <span class="ruby-identifier">critter</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="protected-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Protected Instance Methods</h3>
       </header>

    
      <div id="method-i-express_expression-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">express_expression!</span><span
            class="method-args">(critter)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="express_expression-21-source">
            <pre><span class="ruby-comment"># File lib/rubyneat/expressor.rb, line 106</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">express_expression!</span>(<span class="ruby-identifier">critter</span>)
  <span class="ruby-identifier">critter</span>.<span class="ruby-identifier">phenotype</span>.<span class="ruby-identifier">express!</span>      
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-express_genes-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">express_genes!</span><span
            class="method-args">(critter)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <h1 id="method-i-express_genes-21-label-Expression+of+the+Genotype+as+a+Phenotype.">Expression of the Genotype as a Phenotype.<span><a href="#method-i-express_genes-21-label-Expression+of+the+Genotype+as+a+Phenotype.">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<pre>What this really does is create the function that calls
all the functions. 

This makes use of the Graph plugin for Neurons.</pre>

<h1 id="method-i-express_genes-21-label-Recurrency+and+Expression+of+Genes">Recurrency and Expression of Genes<span><a href="#method-i-express_genes-21-label-Recurrency+and+Expression+of+Genes">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<pre>A simple approach has been taken here to allow for recurrency in
our Critters. Basically, a looping construct has been put around the
activation of the neurons so that recurrency can be done in 2 ways:
 1) Via yielding, thus treating the stimulus function as a enumerable.
  In this approach, one would call the Critter&#39;s phenotype with a block of
  code that would accept the output of the net. It would return &#39;true&#39; to
  continue the iteration, or &#39;false&#39; to end the iteration.
 2) Via multiple calls to the Pheontype instance:
  Since the value of the prior activation is preserved in the instance variables
  of the phenotype, subsequent activations will iterate the network.</pre>

<h2 id="method-i-express_genes-21-label-Cavets+to+recurrent+activation">Cavets to recurrent activation<span><a href="#method-i-express_genes-21-label-Cavets+to+recurrent+activation">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<pre>For (2) above, the input neurons would be overwritten on each subsequent call.
Since we do not allow recurrent connections to input neurons anyway, this should
not be an issue, though we may allow for this at a future date.</pre>
          
          

          
          <div class="method-source-code" id="express_genes-21-source">
            <pre><span class="ruby-comment"># File lib/rubyneat/expressor.rb, line 58</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">express_genes!</span>(<span class="ruby-identifier">critter</span>)
  <span class="ruby-identifier">g</span> = <span class="ruby-identifier">critter</span>.<span class="ruby-identifier">genotype</span>
  <span class="ruby-identifier">p</span> = <span class="ruby-identifier">critter</span>.<span class="ruby-identifier">phenotype</span>

  <span class="ruby-identifier">init_code</span> = <span class="ruby-string">&quot;\n  def initialize_neurons\n&quot;</span>

  <span class="ruby-comment"># &#39;stimulate&#39; function call (really should be &#39;activate&#39;, but we&#39;ll reserve this for something else)</span>
  <span class="ruby-identifier">p</span>.<span class="ruby-identifier">code</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;  def #{NEAT::STIMULUS}(&quot;</span>
  <span class="ruby-identifier">p</span>.<span class="ruby-identifier">code</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">g</span>.<span class="ruby-identifier">neural_inputs</span>.<span class="ruby-identifier">reject</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">sym</span><span class="ruby-operator">|</span> <span class="ruby-identifier">g</span>.<span class="ruby-identifier">neural_inputs</span>[<span class="ruby-identifier">sym</span>].<span class="ruby-identifier">bias?</span> }.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">sym</span>, <span class="ruby-identifier">neu</span><span class="ruby-operator">|</span> <span class="ruby-identifier">sym</span>}.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;, &quot;</span>)
  <span class="ruby-identifier">p</span>.<span class="ruby-identifier">code</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;)\n&quot;</span>

  <span class="ruby-comment"># Assign all the parameters to instance variables.</span>
  <span class="ruby-identifier">p</span>.<span class="ruby-identifier">code</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">g</span>.<span class="ruby-identifier">neural_inputs</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">sym</span>, <span class="ruby-identifier">neu</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;    @#{sym} = #{sym}\n&quot;</span>}.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;&quot;</span>)
  <span class="ruby-identifier">p</span>.<span class="ruby-identifier">code</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;    loop {\n&quot;</span>

  <span class="ruby-comment"># Resolve the order in which we shall call the neurons</span>
  <span class="ruby-comment"># TODO handle the dependency list if it comes back!</span>
  <span class="ruby-ivar">@resolved</span>, <span class="ruby-ivar">@dependencies</span> = <span class="ruby-constant">NEAT</span><span class="ruby-operator">::</span><span class="ruby-constant">Graph</span><span class="ruby-operator">::</span><span class="ruby-constant">DependencyResolver</span>[<span class="ruby-identifier">g</span>.<span class="ruby-identifier">neural_outputs</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">s</span>, <span class="ruby-identifier">neu</span><span class="ruby-operator">|</span> <span class="ruby-identifier">neu</span>}].<span class="ruby-identifier">resolve</span>

  <span class="ruby-comment"># And now call them in that order!</span>
  <span class="ruby-ivar">@resolved</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">neu</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">neu</span>.<span class="ruby-identifier">input?</span>
      <span class="ruby-identifier">init_code</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;    @#{neu.name} = 0\n&quot;</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">g</span>.<span class="ruby-identifier">neural_gene_map</span>.<span class="ruby-identifier">member?</span> <span class="ruby-identifier">neu</span>.<span class="ruby-identifier">name</span>
        <span class="ruby-identifier">p</span>.<span class="ruby-identifier">code</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;      @#{neu.name} = #{neu.name}(&quot;</span>
        <span class="ruby-identifier">p</span>.<span class="ruby-identifier">code</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">g</span>.<span class="ruby-identifier">neural_gene_map</span>[<span class="ruby-identifier">neu</span>.<span class="ruby-identifier">name</span>].<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">gene</span><span class="ruby-operator">|</span>
          <span class="ruby-string">&quot;%s * @%s&quot;</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">gene</span>.<span class="ruby-identifier">weight</span>, <span class="ruby-identifier">gene</span>.<span class="ruby-identifier">in_neuron</span>]
        }.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;, &quot;</span>) <span class="ruby-operator">+</span> <span class="ruby-string">&quot;)\n&quot;</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">g</span>.<span class="ruby-identifier">dangling_neurons</span> = <span class="ruby-keyword">true</span>
        <span class="ruby-identifier">log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;Dangling neuron in critter #{critter} -- #{neu}&quot;</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">init_code</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;  end\n&quot;</span>

  <span class="ruby-comment"># And now return the result as a vector of outputs.</span>
  <span class="ruby-identifier">p</span>.<span class="ruby-identifier">code</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;     @_outvec = [&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">g</span>.<span class="ruby-identifier">neural_outputs</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">sym</span>, <span class="ruby-identifier">neu</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;@#{sym}&quot;</span>}.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;,&#39;</span>) <span class="ruby-operator">+</span> <span class="ruby-string">&quot;]\n&quot;</span>
  <span class="ruby-identifier">p</span>.<span class="ruby-identifier">code</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;     break unless block_given?\n&quot;</span>
  <span class="ruby-identifier">p</span>.<span class="ruby-identifier">code</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;     break unless yield @_outvec\n&quot;</span>
  <span class="ruby-identifier">p</span>.<span class="ruby-identifier">code</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;  }\n&quot;</span>
  <span class="ruby-identifier">p</span>.<span class="ruby-identifier">code</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;  @_outvec\n&quot;</span>
  <span class="ruby-identifier">p</span>.<span class="ruby-identifier">code</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;  end\n&quot;</span>
  <span class="ruby-identifier">p</span>.<span class="ruby-identifier">code</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">init_code</span>
  <span class="ruby-identifier">log</span>.<span class="ruby-identifier">debug</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">code</span>
  <span class="ruby-identifier">p</span>.<span class="ruby-identifier">express!</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-express_neurons-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">express_neurons!</span><span
            class="method-args">(critter)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Express Neurons as methods</p>
          
          

          
          <div class="method-source-code" id="express_neurons-21-source">
            <pre><span class="ruby-comment"># File lib/rubyneat/expressor.rb, line 32</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">express_neurons!</span>(<span class="ruby-identifier">critter</span>)
  <span class="ruby-identifier">critter</span>.<span class="ruby-identifier">genotype</span>.<span class="ruby-identifier">neurons</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">neuron</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">neuron</span>.<span class="ruby-identifier">express</span>(<span class="ruby-identifier">critter</span>.<span class="ruby-identifier">phenotype</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">neuron</span>.<span class="ruby-identifier">input?</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">neuron</span>.<span class="ruby-identifier">bias?</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://rdoc.rubyforge.org">RDoc</a> 4.1.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

